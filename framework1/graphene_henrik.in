newton on
units	 metal

boundary m m m
atom_style atomic

#--------------Create Atoms----------------
lattice custom 2.419 a1 0 1.0 0 a2 $(sqrt(3)/2) 0.5 0 a3 $(1/(2*sqrt(3))) 0.5 0.83 basis 0 0 0 basis $(1/3) $(1/3) 0.0

region myreg block 0.0 44.99 -0.01 39.99 0 0.5 units lattice
create_box 2 myreg

create_atoms 1 box basis 1 1

region right_fix block 44 INF INF INF INF INF
group right_fixed region right_fix

region left_fix block INF 0.5 INF INF INF INF
group left_fixed region left_fix


change_box all z final 0 50
displace_atoms all move 0 0 10


label       loop
variable zones index 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14

if "${cuts} != 0" then "jump SELF continue"

variable xlo equal "floor(v_zones/5)"
variable ylo equal "v_zones%5"

variable mid equal 5.0
variable cutwidth equal 4.4

region mycut block $(v_xlo*15+v_mid) $(v_xlo*15+v_mid+v_cutwidth) $(v_ylo*8.0) $(v_ylo*8.0+8) INF INF units lattice

delete_atoms region mycut
region mycut delete

label 	     continue
next        cuts
next 	     zones
jump        SELF loop

variable xlo delete
variable ylo delete


mass * 12.0107
velocity all create 5.0 5432373 dist gaussian

#------------------

neighbor            0.5 bin
neigh_modify        delay 0 every 1

pair_style          airebo 6.4 1 1
pair_coeff          * * CH.airebo C H

fix                 nve all nve
timestep            0.0005

thermo              10

fix 2 all balance 1000 1.05 shift xy 10 1.05

# Computes for ourput variables
compute left_force left_fixed reduce  sum fx
compute right_force right_fixed reduce  sum fx
variable stress equal "(c_left_force - c_right_force)/(193.6*3.7)/624150913*1e20/2"
compute left_position left_fixed reduce ave x
compute right_position right_fixed reduce ave x
variable width equal "c_right_position-c_left_position"

thermo_style custom step time temp pe c_left_force c_right_force v_stress c_left_position c_right_position v_width  pxx cpuremain
dump 1 all atom 1000 dump.bin


velocity left_fixed set 0 0 0
velocity right_fixed set 0 0 0
fix freeze1 left_fixed setforce 0.0 0.0 0.0
fix freeze2 right_fixed setforce 0.0 0.0 0.0


run                $(floor(50/dt))

variable strain_speed equal "125*0.01"

unfix freeze1
unfix freeze2

fix right_move right_fixed move linear $(v_strain_speed/2) 0 0 units box
fix left_move left_fixed move linear $(-v_strain_speed/2) 0 0 units box

run $(floor(3*125/dt/v_strain_speed))
