units metal
newton on  # newtons 3rd law for pairs

boundary m m m  
atom_style atomic # coarse-grain liquids, solids, metals


variable eps equal 1e-6

# ---- Create atoms --- #
# Parameters
variable a equal 5.43  # lattice spacing [Å]
variable xmax equal 100 # [Å]
variable ymax equal 100  # [Å]
variable zmax equal 15
  # [Å]

# Number of unit cells to get closest to x-y-z-max
variable xlen equal $(round((v_xmax + 1/4*v_a)/v_a))  # [a]
variable ylen equal $(round((v_ymax + 1/4*v_a)/v_a))  # [a]
variable zlen equal $(round((v_zmax)/v_a))  # [a]
print "xlen, ylen, zlen:  ($(v_xlen), $(v_ylen), $(v_zlen))"
print "Max pos:  $(v_xlen*v_a - 1/4*v_a), $(v_ylen*v_a - 1/4*v_a), $(-v_zlen*v_a)"
# quit # Check dimenstions before running


# Create lattice and simulation box
variable restart equal true
if ${restart} then "read_restart ./melted_Si_substrate.bin" else &
"lattice diamond ${a}" &
"region myreg block -${eps} ${xlen} -${eps} ${ylen} -${zlen} ${eps}  units lattice" &
"create_box 1 myreg" &
"create_atoms 1 box" &


# Regions and groups
# variable freeze_zhi equal $(-(v_zlen-1)*v_a + 0.5)
# region freeze_region block INF INF INF INF INF ${freeze_zhi} units box
region freeze_region block INF INF INF INF INF $(-v_zlen+1) units lattice
group freeze_group region freeze_region
group moving_atoms subtract all freeze_group

# --- Dynamics --- #
# parameters
variable Tstart equal 1800.0 # [Kelvin]
# variable Tstart equal 3000.0 # [Kelvin]


# variable Tstop equal 300.0 # [Kelvin]
# variable Tdamp equal $((v_Tstart - v_Tstop)/10)
# variable Tdamp equal 0.1




mass 1 28.0855 # Si atomic mass [u]
velocity moving_atoms create ${Tstart} 5432371 dist gaussian

neighbor            0.5 bin
neigh_modify        delay 0 every 1 one 10000

# Stillinger-Weber (SW)
pair_style sw
pair_coeff * * si.sw Si

# timestep            0.0005
timestep            0.001


thermo              100
thermo_style custom step time temp 
dump 1 all atom 100 dump.data


# --- Melting --- #
# fix                 nve moving_atoms nve # (microcanonical)
fix                 nvt moving_atoms nvt temp ${Tstart} ${Tstart} 0.1



compute myRDF moving_atoms rdf 100
fix rdf_output moving_atoms ave/time 500 1 500 c_myRDF[*] file rdf.txt mode vector # Nevery Nrepeat Nfreq 

run $(floor(2/dt))


# fix                 1 moving_atoms nvt temp ${Tstart} ${Tstop} ${Tdamp} # (Nosé Hoover thermostat)
write_restart melted_Si_substrate.bin 

# write_data melted_Si_substrate.txt




