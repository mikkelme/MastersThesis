# --- Basics --- # 
units metal
newton on #newtons 3rd law for pairs
boundary m m m  
atom_style atomic # coarse-grain liquids, solids, metals


# --- Read files --- #
read_data ../config_builder/sheet_vacuum.txt      # sheet 
include ../config_builder/info_sheet_vacuum.in    # import variables

# --- Regions and groups --- #
# Sheet 
region sheet_region block INF INF ${pullblock_yhi} ${pullblock_ylo} INF INF
group sheet region sheet_region

# Pullblocks
region PB_ylow_region  block INF INF INF ${pullblock_yhi} INF INF
region PB_yhigh_region block INF INF ${pullblock_ylo} INF INF INF
group PB_ylow region PB_ylow_region
group PB_yhigh region PB_yhigh_region

# Moving atoms
group moving_atoms subtract all PB_ylow PB_yhigh


#--- Dynamics ---#
variable temp equal 5.0 # Kelvin

mass 1 12.0107 # C

velocity moving_atoms create ${temp} 5432373 dist gaussian

neighbor            0.5 bin
neigh_modify        delay 0 every 1 one 10000

# Airebo 
pair_style airebo 6.4 1 1
pair_coeff * * ../potentials/CH.airebo C # C-C
quit

# Play around to understand syntax
# pair_style hybrid lj/cut 2.5 #sw
# pair_coeff 1 1 lj/cut 1.1 3.0         
# pair_coeff 1 2 lj/cut 1.1 3.0     
# pair_coeff 2 2 lj/cut 1.1 3.0         

# Tersoff
# pair_style hybrid sw lj/cut 2.5 tersoff
# pair_coeff * * tersoff ../potentials/SiC_1989.tersoff C NULL
# pair_coeff 1 2 lj/cut 0.0096 3.0         # Interaction C-Si (Double check parameters)
# pair_coeff * * sw ../potentials/si.sw NULL Si   # Substrate Si-Si

# Airebo 
pair_style hybrid sw lj/cut 2.5 airebo 6.4 1 1
pair_coeff * * airebo ../potentials/CH.airebo C NULL # C-C
pair_coeff 1 2 lj/cut 0.008909 3.26      # Interaction C-Si (Double check parameters)
pair_coeff * * sw ../potentials/si.sw NULL Si   # Substrate Si-Si


timestep            0.0005
thermo              100
thermo_style custom step time temp 
fix                 nve moving_atoms nve # (microcanonical) 
# fix 2 all balance 1000 1.05 shift xy 10 1.05 # balance number of particles computed on each processor 


# --- Dump --- #
dump 1 all custom 1 system.data id type x y z vx vy vz
dump 2 sheet custom 100 sheet.data id x y z
dump 3 substrate_contact custom 100 substrate_contact.data id x y z


# ---  Relax inner part (pattern) of sheet --- #
# run  $(floor(10/dt)) # [t] = picoseconds

# --- Stretch --- #
# Parameters
variable strain_speed_pct equal 0.03 # [% of pattern ylen per picoseconds]
variable strain_max_pct equal 0.20 
variable strain_speed equal v_strain_speed_pct*(v_pullblock_ylo-v_pullblock_yhi) # Henrik used 1,25
variable stretch_time equal $(floor(v_strain_max_pct/v_strain_speed_pct/dt))
print "strain_speed: ${strain_speed}"

# Output: timestep, stretch_pct
print "# timestep, stretch_pct" file stretch_pct.txt
fix stretch_pct all print 100 "$(step), $(time*v_strain_speed_pct)" screen no append stretch_pct.txt
## ^^^Fix this to start at right time and reverse


quit

# Stretch sheet
fix ylow_move  PB_ylow move linear 0 $(-v_strain_speed/2) 0 units box
fix yhigh_move PB_yhigh move linear 0 $(v_strain_speed/2) 0 units box

print "Stretching, timesteps: ${stretch_time}"
run ${stretch_time}
 
# Pause 
unfix ylow_move
unfix yhigh_move
run  $(floor(1/dt)) # [t] = picoseconds

# Conpress sheet
fix ylow_move  PB_ylow move linear 0 $(v_strain_speed/2) 0 units box
fix yhigh_move PB_yhigh move linear 0 $(-v_strain_speed/2) 0 units box

print "Reverse stretch, timesteps: ${stretch_time}"
run ${stretch_time}





