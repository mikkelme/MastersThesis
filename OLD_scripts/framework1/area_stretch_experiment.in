# --- Basics --- # 
units metal
newton on #newtons 3rd law for pairs

boundary m m m  

atom_style atomic # coarse-grain liquids, solids, metals


# --- Read files --- #
read_data ./lammps_sheet_and_block  # read sheet and block from file
include ./simulation_lim.in         # region limits


# --- Regions and groups --- #

# Pulling blocks
variable block_elem equal 2                             # block thicknes in terms of matrix columns
variable yscale equal 1.230                             # length per column
variable block_thickness equal ${block_elem}*${yscale}  # physical length of end blocks
variable eps equal 1e-3                                 # small number for avoiding spill of the freeze region

variable ylow_top equal ${block_thickness}-${eps}           # max y-val of lower block
variable yhigh_bottom equal yhi-${block_thickness}+${eps}   # min y val of upper block

region ylow_region block INF INF INF ${pullblock_yhi} INF ${pullblock_zhi}
region yhigh_region block INF INF ${pullblock_ylo} INF INF ${pullblock_zhi}
region zhigh_region block INF INF INF INF ${diamond_zlo} INF
group  ylow_group region ylow_region
group  yhigh_group region yhigh_region
group zhigh_group region zhigh_region



# velocity ylow_group set 0 0 0
# velocity yhigh_group set 0 0 0
# velocity zhigh_group set 0 0 0

# fix freeze1 ylow_group setforce 0.0 0.0 0.0
# fix freeze2 yhigh_group setforce 0.0 0.0 0.0
# fix freeze3 zhigh_group setforce 0.0 0.0 0.0


# Contact area
region sheet_region block INF INF ${pullblock_yhi} ${pullblock_ylo} INF ${pullblock_zhi}
region lower_block_region block INF INF INF INF ${pullblock_zhi} ${diamond_zhi}

group sheet_group region sheet_region
group lower_block_group region lower_block_region

group moving_atoms subtract all ylow_group yhigh_group zhigh_group






#--- Dynamics ---#
variable temp equal 5.0 # Kelvin

mass * 12.0107 # "*": all types, [grams/mole]
velocity moving_atoms create ${temp} 5432373 dist gaussian

neighbor            0.5 bin
neigh_modify        delay 0 every 1 one 10000

pair_style          airebo 6.4 1 1  # cutoff LJ_flag TORSION_flag cutoff_min
pair_coeff          * * CH.airebo C # add H for hydrogren as 2nd particle

timestep            0.0005

thermo              100
fix                 nve moving_atoms nve # (microcanonical)  #<--------- only apply on not froozen 


# fix 2 all balance 1000 1.05 shift xy 10 1.05 # balance number of particles computed on each processor 
dump 1 all custom 10 sheet_and_block.data id type x y z vx vy vz
dump 2 sheet_group custom 100 sheet.data id x y z
dump 3 lower_block_group custom 100 lower_block.data id x y z



# ---  Relax inner part (pattern) of sheet --- #
run 300
# run  $(floor(4/dt)) # [t] = picoseconds

# Release freezes 
# unfix freeze1
# unfix freeze2

# --- Stretch --- #
variable strain_speed_pct equal 0.02 # [% of pattern ylen per picoseconds]
variable strain_speed equal v_strain_speed_pct*(v_pullblock_ylo-v_pullblock_yhi) # Henrik used 1,25
print "strain_speed: ${strain_speed}"

# Move pulling block in opposite direction
fix ylow_move ylow_group move linear 0 $(-v_strain_speed/2) 0 units box
fix yhigh_move yhigh_group move linear 0 $(v_strain_speed/2) 0 units box

# run  $(floor(4/dt)) # [t] = picoseconds






