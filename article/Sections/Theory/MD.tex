\chapter{Molecular Dynamics}
% \cite[p. 18-]{Manini_2016}

Thanks to advances in computing algorithms and hardware the recent years has witnessed a remarkable increase in our ability to simulate tribological processes in realistic nano-frictional system \cite{Manini_2016}. A Molecular dynamics (MD) simulation can be considered as computational ``experiment''. Given a set of inital conditions and a mathematically model for interatomic forces we can solve Newton's (or equivalent) equation of motion by numerical integration [p. 303]{BHUSHAN20051507}. The interatomic forces are derived from interparticle interaction potentials, which is the heart of MD simulations and the specific choice of potentials can often be quite challenging.


Alternatives to the MD simulation like Ab inito methods calculate the interaction based on quantam mechanis (solving schrödinger) right?



% \begin{itemize}
%   \item MD simulation (classical or ab initio)
%   \item Basics of classical MD simulations: Integration and stuff
%   \item Ab initio simulation (quantum mechanics, solving schrödinger)
% \end{itemize}



% A promising compromise could possibly be provided by the so-called reactive potentials [120–122], capable of describing some chemical reactions, including interface wear with satisfactory computational efficiency in large-scale atomic simulations, compared to semi-empirical and first-principles approaches. \cite{Manini_2016}





% Quantum-mechanical calculations is more accurate but to numerical intensive.

% Despite recent progress in this respect, it is clear that there will always be
% interesting problems beyond the reach of ab initio approaches
% \cite{PhysRevB.37.6991}.





% The simplest approach to temperature control by adding the Langevin thermostat has been widely adopted, but more refinded methods has also been proposed and adopted (see \cite{Manini_2016} for more).

% Physically relevant quantities like the average friction force can be evaluated by carrying out averages over the model dynamics. The modeling most first of all adress equlibrium and near-equlibrium behvaiour where the fluctuation-dissipation theorem governs the conversion of mechanical energy into heat. But it most also deal with nonlinear dissipative phenomena such as instabilities and stick-slip.\cite{Manini_2016}

% Quantitative data can be obtained by analyzing the numerical output directly. [p. 303]{BHUSHAN20051507}


% Weak- nesses include a lack of quantum effects in classical atomistic dynamics, and perhaps more importantly, the fact that meaningless results can be obtained if the simulation conditions are incorrectly chosen. \cite[p. 303]{BHUSHAN20051507}


% Maybe read ``Computer Simulations 7 of Nanometer-Scale Indentation
% and Friction'' from \cite{BHUSHAN20051507}



\section{Potentials}
% \cite{PhysRevB.37.6991}


The potentials used in our MD simulation is mainly based on the of Li et al.\
\cite{li_evolving_2016} which have a somewhat similar MD friction simulation
setup. Li et al.\ impose a Silicon tip on the graphene sheet supported by a
Silicon substrate where we slide the whole sheet upon the substrate.
Nonetheless, this serves as a good anchor for the methodology of the setup. The
covalent bonds of C-C in graphene and Si-Si in the substrate is described by the
Tersoff and Stillinger–Weber potentials, respectively. A typical 12-6
Lennard–Jones potential is used to describe the van der Waals adhesive
interaction between graphene and the substrate. 

\subsection{General formulation of potentials (?)}
On a general note we can generalize the n-body potential as the expansion in
orders of participating atoms as 
\begin{align*}
  E = \sum_i V_1(\vec{r}_i) + 
      \sum_{\substack{i, j \\ i < j}} V_2(\vec{r}_i, \vec{r}_j) +  
      \sum_{\substack{i,j,k \\ i < j < k}} V_3(\vec{r}_i, \vec{r}_j, \vec{r}_i) + \cdots,
\end{align*} 
where $\vec{r}_n$ is the position of the $n$th particle and $V_m$ is called an
$m$-body potential  \cite{PhysRevB.37.6991}. The first one-body term corresponds
to an external potential, followed by the two-body term, the three-body term and
so on. The simplest model that includes particle interaction is the pair
potential truncating the expansion after the two-body term. A general feature of
the pair potentials is that they favor close-packed structures which is unsuited
to describe covalent bonds that take more open structures. In particular, pair
potentials are completely inapplicable to strongly covalent systems \cite{PhysRevB.37.6991}. In order to accomodate the description
of covalent bonds the natural step is thus to include the next step of the
expansion, the three-body terms, as we will see for the modeling of the C-C bonds in the graphene sheet and the Si-Si bonds in Silicon substrate. For the interaction between
the sheet and the substrate we use a Lennard Jones pair potential
describing the non-bonded van der Waals interaction. This simple interaction model between the moving object and substrate has come to be the standard in friction simulations \cite{zhu_study_2018}, \cite{ZHANG201585}, \cite{Yoon2015MolecularDS}, \cite{kim_nano-scale_2009}. 


\subsection{Lennard Jones}
\hl{TODO: Add potential curve figure} \\
% TODO: Add potential curve figure
This sections is based on \cite{docs_lammps_LJ}, \cite{C9CP05445F}, \cite{chem_libretexts_LJ}.

The Lennard-Jones (LJ) model is probably one of the most famous pair potentials
used in MD simulations. LJ models the potential energy between two non-bonding
atoms solely based on interatomc distance. The model accounts for attractive
forces arising from dipole-dipole, dipole-induced dipole and London
interactions, and repulsive forces that capture the hard core of overlapping wave functions at small distances (\hl{double check this statement}). Thus, it assummes
neutrally charged atoms and was orginally proposed for noble gases. The
classical 12-6 version of the model (refering to the power law of the repulsive
and attractive forces respectively) reads
\begin{align}
  E = 4\epsilon \left[\left(\frac{\sigma}{r}\right)^{12} - \left(\frac{\sigma}{r}\right)^6 \right ], \qquad r < r_c,
  \label{eq:LJ}
\end{align}
where $r$ is the interatomic distance with cut-off $r_c$, $\epsilon$ is the
depth of the potential well and $\sigma$ the interatomic distance where the potential is
zero. By solving for the potential minimum ($dE/dr = 0$) we find the equilibrium
distance to be $r_0 = \sigma 2^{1/6}$. This makes for a slightly more intuitive
interpration of $\sigma$ which effectively sets the equilirbium distance between
atoms, i.e.\ the dividing line for which the force is repulsive or
attractive. 


% While the LJ model in many ways is an oversimplified model that is
% insufficient in its description of ... (\hl{get source and concrete examples}) it is
% commonly used as a model for intermaterial interactions (between moving object
% and substrate) in friction studies.


\subsection{Stillinger weber}
% Todo: Add some potential curve figure? or figure of three body angles?
\hl{TODO: Add potential figure and or figure illustrating three body angles}.

This section is based on [\cite{docs_lammps_sw}, \cite{PhysRevB.31.5262}]

The stillinger weber potential takes the form of a three body potential
\begin{align*}
  E &=\sum_i \sum_{j>i} \phi_2(r_{i j})+\sum_i \sum_{j \neq i} \sum_{k>j} \phi_3(r_{ij}, r_{ik}, \theta_{ijk}),
\end{align*}
where $r_{ij}$ denotes the distance between atom $i$ and $j$ and $\theta_{ijk}$
the angle between bond $ij$ and $jk$. The summations is over all neighbours $j$
and $k$ of atom $i$ within a cut-off distance $r = a\sigma$. \\
The two-body term $\phi_2$ builds from the LJ model with the addition of an
exponetial cutoff term
\begin{align}
  \phi_2(r_{i j}) & =A_{ij} \epsilon_{ij}\left[B_{ij}\left(\frac{\sigma_{ij}}{r_{ij}}\right)^{p_{ij}} - \left(\frac{\sigma_{ij}}{r_{ij}}\right)^{q_{ij}}\right] \exp (\frac{\sigma_{ij}}{r_{ij}-a_{ij} \sigma_{ij}}).
  \label{eq:sw_2}
\end{align}

The model parameters $A$, $\epsilon$, $B$, $\sigma$, $p$, $q$ and $a$ comes with
$i,j$ indices to indicate that theese parameters should be specified for each
unique pair of atom types. However, in our case we will only provide a single
value for each model parameter as we are exclusively dealing with Si-Si bonds.
We see that the first term in \cref{eq:sw_2} is reminiscent of the LJ model
in \cref{eq:LJ} while the last term effectively drives the potential to
zero at $r=a\sigma$, which is thus the chosen cut-off distance for the potential
evaluation. With the model parameters for the Si-Si modelling (see \cref{tab:sw_param}) the cut-off becomes $\sim 3.8$ Å. \\
The three body term includes an angle dependency as
\begin{align}
  \phi_3(r_{ij}, r_{ik}, \theta_{ijk}) &= \lambda_{ijk} \ \epsilon_{ijk} \Big[\cos \theta_{ijk}-\cos \theta_{0,ijk}\Big]^2 \exp (\frac{\gamma_{ij} \sigma_{ij}}{r_{ij} - a_{ij} \sigma_{ij}}) \exp (\frac{\gamma_{ik} \sigma_{ik}}{r_{ik} - a_{ik} \sigma_{ik}}),
  \label{eq:sw_3}
\end{align}
where $\theta_{0,ijk}$ is the equilibrium angle. The first term of
\cref{eq:sw_3} includes an angle dependency analog to a harmonic oscillator
based on a cosine angle distance from the equilibrium angle. The final two terms
act again as a cut-off function by driving the potential to zero at $r_{ij} =
a_{ij}\sigma_{ij}$ and $r_{ik} = a_{ik}\sigma_{ik}$ respectively. \\ 
The parameters used for the Si-Si bond modeling is displayed in \cref{tab:sw_param} along with an interpretation of each model parameter.



\begin{table}[H]
  \begin{center}
  \caption{Parameters for the stilliner weber potential used for intermolecular interactions in the silicon substrate.}
  \label{tab:sw_param}
  \begin{tabular}{ | c | c | L{9cm} |} \hline
    Parameter & Value & Description \\ \hline 
    $\epsilon$ & 2.1683  & Individual depth of the potential well for each atom
    type pair/tiplets. \\ \hline
    $\sigma$ & 2.0951 & Distance for which the individual pair interactions has
    zero potential (analog to the LJ model). \\ \hline
    $a$ & 1.80 & The individual cut-off distance for each atom type pair. \\
    \hline
    $\lambda$ & 21.0 & The overall depth of the three-body potential well. \\
    \hline
    $\gamma$ & 1.20 & The shape of the three-body cut-off terms. \\ \hline
    $\cos{(\theta_0)}$ & -1/3 & Cosine of equilibrium angle. \\ \hline
    $A$ &  7.049556277 & The overall depth of the two-body potential well. \\
    \hline
    $B$ &  0.6022245584 & Scales the repulsion part of the two-body term. \\
    \hline
    $p$  & 4.0 & The power dependency for the repulsion part of the two-body
    term. \\ \hline
    $q$  & 0.0 & The power dependency for the attraction part of the two-body
    term. \\ \hline
    tol  & 0.0 & LAMMPS: Option to define a different cut-off than the
    theoretical of $r = a\sigma$. $tol = 0$ refers to the theoretical being
    used. \\ \hline
  \end{tabular}
  \end{center}
\end{table}



\subsection{Tersoff}
% Add figure similar to:
% https://en.wikipedia.org/wiki/Bond_order_potential#/media/File:Bond-order_interatomic_potential.png,
% showing bond order curves.


% https://interatomic-potentials.readthedocs.io/en/latest/doc/tersoff.html
% https://chem.libretexts.org/Bookshelves/
% Physical_and_Theoretical_Chemistry_Textbook_Maps/Supplemental_Modules_(Physical_and_Theoretical_Chemistry)/Chemical_Bonding/Fundamentals_of_Chemical_Bonding/Bond_Order_and_Lengths
This section is based on [\cite{docs_lammps_tersoff}, \cite{PhysRevB.37.6991}].


The tersoff potential abandon the idea of a general $n$-body form and attempts
instead to build the model on a more physics informed approach; The more
neighbours an atom has the weaker the bonds will be. Thus it introduces the bond
order (bond strentgh), that is environment specific and decrease with increasing
bond coordination (number of neighbours for a given atom). The potential energy
is taken to have the form

\begin{align*}
  E &= \sum_i E_i = \frac{1}{2}\sum_{i \ne j} V_{ij}, \\
  V_{ij} &= f_C(r_{ij}) \big[f_R(r_{ij}) + b_{ij}f_A(r_{ij})  \big],
\end{align*}

% where the total potential energy is decomposed into an atom site energy $E_i$
% and a bond energy $v_{ij}$. 
where the total potential energy is decomposed into a bond energy $V_{ij}$. The
indices $i$ and $j$ run over the atoms of the system with $r_{ij}$ denoting the
distance between atom $i$ and $j$. Notice that the sum includes all combinations
of $i,j$ where $i\ne j$ meaning that the same bond is double counted which is
the reason for the additional factor $1/2$. The reasoning behind comes from the
asymmetry of the bond order $b_{ij}\ne b_{ji}$ leading to a $V_{ij}\ne V_{ji}$.
The bond energy is composed of a repulsive term $f_R$, arising from overlapping
wave functions, and an attractive term $f_A$ associated with bonding. $f_c$ is
simply a smooth cut-off function to increase computational efficiency. $b_{ij}$
represent the bond order, i.e. the strength of the bonds, which depends
inversely on the number of bonds, the bond angles ($\theta_{ijk}$) and
optionally the relative bonds lengths ($r_{ij}$, $r{jk}$). Notice that an
additional cut-off term $a_{ij}$ was orginally multiplied to $f_R$ as a way of
including terms that limit the range of the interactions to the first neighbour
shell. These kind of limitations is already included in $b_{ij}$ for the
attractive term $f_A$ but is often omitted for the repulsive term $f_R$, and we
do so to by setting $a_{ij} = 1$. \\
The cut-off function $f_C$ goes from 1 to 0 over a small interval range $R \pm
D$ as
\begin{align*}
  f_C(r) =
  \begin{cases}
    1 & r < R - D \\
    \frac{1}{2} - \frac{1}{2} \sin{(\frac{\pi}{2} \frac{r - R}{D})} & R - D < r < R + D\\
    0 & r > R + D
  \end{cases},
\end{align*}
which is continuous and differentiable for all $r$. $R$ is usually chosen to
include only the first neighbour shell. \\
The repulsive and attractive terms $f_R$ and $f_A$ is modelled as an exponetial
function, similar to a morse potential, 
\begin{align*}
 f_R(r) &= A \exp(-\lambda_1 r), \\
 f_A(r) &= -B \exp \big(-\lambda_2 r\big).
\end{align*}

The novel feature of the model lies in modeling of the bond order $b_{ij}$ which
includes three-body interactions by summing over a third atom $k \ne i,j$ within
the cut-off $r_{ik} < R + D$ as shown in the following.

\begin{align}
  b_{i j} & =\big(1+\beta^n \zeta_{i j}^n\big)^{-\frac{1}{2 n}} \\
  \zeta_{i j} & =\sum_{k \ne i,j} f_C(r_{i k}) g\Big(\theta_{i j k}\left(r_{i j}, r_{i k}\right)\Big) \exp \left(\lambda_3{ }^m\big(r_{i j}-r_{i k}\right)^m\big) \\
  g(\theta) & =\gamma_{i j k}\left(1+\frac{c^2}{d^2}-\frac{c^2}{\left[d^2+\left(\cos \theta-\cos \theta_0\right)^2\right]}\right).
  \label{eq:tersoff_bond_order}
\end{align}

In \cref{eq:tersoff_bond_order} $\zeta_{i,j}$ is an effective coordination
and $g(\theta)$ captures angle dependency as it is minimized at the equilibrium
angle $\theta = \theta_0$. \\
The parameters used to model the graphene C-C bonds is summarized in \cref{tab:tersoff_param}



\begin{table}[H]
  \begin{center}
  \caption{Parameters for the tersoff potential used for intermolecular interations in the graphene sheet}
  \label{tab:tersoff_param}
  \begin{tabular}{ | c | c | L{9cm} |} \hline
    Parameter & Value & Description \\ \hline 
    $m$ & 3.0 & Default (not used since $\lambda_3 = 0$ ) \\ \hline
    $\gamma$ & 1.0 & ... \\ \hline
    $\lambda_3$ & 0.0 Å$^{-1}$ & ... \\ \hline
    $c$ & \num{3.8049e4} & Strength of the angular effect \\ \hline
    $d$ & 4.3484 & Determines the ``sharpness'' of the angular dependency \\
    \hline
    $\cos{(\theta_0)}$ & -0.57058 & Cosine of the equilibrium angle \\ \hline
    $n$ & 0.72751 & Power law exponent for the bond order dependency \\ \hline
    $\beta$ & \num{1.5724e-7} & ... \\ \hline
    $\lambda_2$ & 2.2119 Å$^{-1}$ & Decay of repulsion potential term \\ \hline
    $B$ & 346.74 eV & Attractive potential term minimum at core ($ r_{ij} = 0$).
    \\ \hline
    $R$ & 1.95 Å & Center distance for cut-off \\ \hline
    $D$  & 0.15 Å & Thickness of cut-off layers \\ \hline
    $\lambda_1$ & 3.4879 Å$^{-1}$ & Decay of repulsion potential term \\ \hline
    $A$ & 1393.6 eV & Repulsion potential term at core ($ r_{ij} = 0$) \\ \hline
  \end{tabular}
  \end{center}
\end{table}



\section{Integration}
% https://www.eng.uc.edu/~beaucag/Classes/AdvancedMaterialsThermodynamics/Books/%5BComputational%20science%20(San%20Diego,%20Calif.)%5D%20Daan%20Frenkel_%20Berend%20Smit%20-%20Understanding%20molecular%20simulation%20_%20from%20algorithms%20to%20applications%20(2002,%20Academic%20Press%20)%20-%20libgen.lc.pdf

Having defined a system of particles governed by interartomic potentials we need
to move the system forward in time. By solving Newtons equations of motion we
effectively sample the microcanonical ensemble characterized by a
constant number of particles $N$, volume $V$ and energy $E$, hence denoted NVE.
Newtons equaitons of motion read
\begin{align}
  m_i \frac{d^2 \vec{r}_i}{dt^2} = \vec{F}_i = -\nabla U_i
  \label{eq:NE}
\end{align}
where $i$ is the particle index and $m_i$ its mass, $\vec{r}_i = (x_i, y_i,
z_i)$ the position, $t$ is time,  $\nabla_i = (\frac{\partial}{\partial x_i},
\frac{\partial}{\partial y_i}, \frac{\partial}{\partial z_i})$ and $U_i$ the
potential energy. The potential energy is a function of the particle
positions of nearby particles depending on the specefic potential in use. Since
the forces defined by the potentials is conservative we expect the energy of the
solution to be conserved. We can redefine \cref{eq:NE} in terms of two coupled
first order differential equations 
\begin{align}
  \dot{\vec{v}}_i(t) = \frac{\vec{F}}{m_i}, \qquad \dot{\vec{r}}_i(t) = \vec{v}_i(t),
  \label{eq:NE_2}
\end{align}
where $\dot{x} = dx/dt$ (Newton's notation) and $\vec{v} = (v_x, v_y, v_z)$ is
velocity. Numerically we can solve the coupled equations by
integrating over discrete timnesteps. That is, we discretize the solution into
temporal steps $t_k = t_0 + k\Delta t$ with start time $t_0$ and time-step $\Delta t$. 

% However small erros applied by the discrete integraiton algorithm we end up
% having an energy error. This is sensitive to time step. 


\subsection{Velocity Verlet}
% http://www.physics.drexel.edu/~valliere/PHYS305/Diff_Eq_Integrators/Verlet_Methods/Diffrntleqn3.pdf
% ttps://www2.ph.ed.ac.uk/~dmarendu/MVP/MVP03.pdf

A common algorithm to integrate Newtons equation of motion (as formulated in
\cref{eq:NE_2}) is the \textit{velocity verlet}. We can derive the algorithm
by the use of Taylor expansions. We begin by expanding the next-step position
vector $\vec{r}_i(t + \Delta t)$ at time $t$
\begin{align}
  \vec{r}_i(t + \Delta t) &= \vec{r}_i(t) + \dot{\vec{r}}_i(t) \Delta t + \frac{\ddot{\vec{r}}_i(t)}{2} \Delta t^2 + \mathcal{O}(\Delta t^3) \label{eq:vv_comp1},
\end{align}
where $\ddot{\vec{r}} = d^2\vec{r}/dt^2$ and $\Delta t^n$ is simply the relaxed
notation for $(\Delta t)^n$. Similar we take the expansions of the next-step
velocity vector $\vec{v}_i(t+\Delta t)$ at time $t$ 
\begin{align}
  \vec{v}_i(t+\Delta t) = \vec{v}_i(t) + \dot{\vec{v}}_i(t) \Delta t + \frac{\ddot{\vec{v}}_i(t)}{2}\Delta t^2 + \mathcal{O}(\Delta t^3).
  \label{eq:tay_v1}
\end{align}
Finnally, by taking the expansion of $\dot{\vec{v}}_i(t+\Delta t)$ we can
eliminate the $\ddot{\vec{v}}_i$-term in \cref{eq:tay_v1} and simplify it
as shown in the following.
\begin{align}
  \dot{\vec{v}}_i(t+\Delta t) &= \dot{\vec{v}}_i(t) + \ddot{\vec{v}}_i(t) \Delta t + \mathcal{O}(\Delta t^2) \nonumber \\
  \frac{\ddot{\vec{v}}_i(t)}{2}\Delta t^2 &= \frac{\Delta t}{2}\Big( \dot{\vec{v}}(t+\Delta t) - \dot{\vec{v}}_i(t)\Big) + \mathcal{O}(\Delta t^3) \nonumber \\
  &\Downarrow \nonumber \\
  \vec{v}_i(t+\Delta t) &= \vec{v}_i(t) + \dot{\vec{v}}_i(t) \Delta t + \frac{\Delta t}{2}\Big( \dot{\vec{v}}_i(t+\Delta t) - \dot{\vec{v}}_i(t)\Big) + \mathcal{O}(\Delta t^3) \nonumber \\
  &=  \vec{v}_i(t) + \frac{\Delta t}{2}\Big( \dot{\vec{v}}_i(t) +  \dot{\vec{v}}_i(t+\Delta t)\Big) + \mathcal{O}(\Delta t^3).
  \label{eq:vv_comp2}
\end{align}
By combining \cref{eq:vv_comp1} and \cref{eq:vv_comp2} and using
Newton's second equation $\dot{\vec{v}} = \vec{F}_i(t)/m_i = $ and $\vec{v} =
\dot{\vec{r}}$ we arrive at the final scheme
\begin{align*}
  \vec{r}_i(t + \Delta t) &= \vec{r}_i(t) + \vec{v}_i(t) \Delta t + \frac{\vec{F}_i(t)}{2m_i}\Delta t^2 + \mathcal{O}(\Delta t^3), \\
  \vec{v}_i(t+\Delta t)  &= \vec{v}_i(t) + \frac{\vec{F}_i(t) + \vec{F}_i(t+\Delta t)}{2m_i}  \Delta t + \mathcal{O}(\Delta t^3).
\end{align*}
The scheme will give a local error of order $\Delta t^3$ corresponding to a
global error of $\Delta t^2$. One of the most popular ways to implement this
numerically is as stated in the following steps.
\begin{enumerate}
  \centering
  \item Calculate $v_{k+\frac{1}{2}} = v_k + \frac{F_k}{2m} \Delta t$.
  \item Calculate $r_{k+1} = r_k + v_{k+\frac{1}{2}} \Delta t$.
  \item Evaluate the force $F_{k+1} = F(r_{k+1})$.
  \item Calculate $v_{k+1} = v_{k+\frac{1}{2}} + \frac{F_{k+1}}{2m} \Delta t$  
\end{enumerate}





% \begin{align*} \vec{r}_i(t + \Delta t) &= \vec{r}_i(t) + \vec{v}_i(t) \Delta t
%   + \frac{\vec{F}_i(t)}{2m_i}\Delta t^2 + \mathcal{O}(\Delta t^3), \\
%   \vec{v}_i(t+\Delta t)  &= \vec{v}_i(t) + \frac{\vec{F}_i(t) +
% \vec{F}_i(t+\Delta t)}{2m_i}  \Delta t + \mathcal{O}(\Delta t^3). \end{align*}
% This scheme will give a local error of order $\Delta t^3$ corresponding to a
% global error of $\Delta t^2$. 

% Lets descritize the time as $t_k = k * \Delta t$ with position $\vec{r}_k$ and
% velocity $\vec{v}_k$. At time $t_k$ the acceleration is given $\vec{a}_k =
% F(\vec{r}_k)/m$. We get the implementation steps as follows \begin{enumerate}
% \item Calculate $\vec{r}_{k+1} = \vec{r}_k + \vec{v}_k \Delta t +
% \frac{F(\vec{r}_k)}{2m}(\Delta t)^2$ \item Evaluate $F(\vec{r}_{k+1})$ \item
% Calculate $\vec{v}_{k+1} = \vec{v}_k + \frac{F(\vec{r}_k) +
% F(\vec{r}_{k+1})}{2m} \Delta t$ \end{enumerate}


% It is sometimes expressed as the following. This is mathematically the same,
% but is it computaitonally more efficient?


% \begin{align*} \mathbf{r}_i(t+\delta t) & =\mathbf{r}_i(t)+\mathbf{v}_i(t)
%   \delta t+\frac{\mathbf{f}_i(t)}{2 m_i} \delta t^2 \\
%   \mathbf{v}_i(t+\delta t / 2) & =\mathbf{v}_i(t)+\frac{\delta t}{2}
%   \frac{\mathbf{f}_i(t)}{m_i} \\
%   \mathbf{f}_i(t+\delta t) & =\mathbf{f}_i\left(\mathbf{r}_i(t+\delta
%   t)\right) \\
%   \mathbf{v}_i(t+\delta t) & =\mathbf{v}_i(t+\delta t / 2)+\frac{\delta t}{2}
%   \frac{\mathbf{f}_i(t+\delta t)}{m_i} \end{align*}

%   % https://www2.ph.ed.ac.uk/~dmarendu/MVP/MVP03.pdf Further they suggest this
%   to be the most used algorithm

%   \begin{align*} \mathbf{v}_i(t+\delta t / 2) & =\mathbf{v}_i(t)+\frac{\delta
%     t}{2} \frac{\mathbf{f}_i(t)}{m_i} \\
%     \mathbf{r}_i(t+\delta t) & =\mathbf{r}_i(t)+\mathbf{v}_i(t+\delta t / 2)
%     \delta t \\
%     \vec{f}_i(t + \delta t) &= \vec{f}_i(\vec{r}_i(t+ \delta t)) \\
%     \mathbf{v}_i(t+\delta t) & =\mathbf{v}_i(t+\delta t / 2)+\frac{\delta
%   t}{2} \frac{\mathbf{f}_i(t+\delta t)}{m_i} \end{align*} Make sure to check
%   this out. 

\section{Thermostats}

As we already mentioned above in Sec. 2, any kind of sliding friction involves mechanical work, some of which is then transformed into heat (the rest going into structural transformations, wear, etc.). The heat is then transported away by phonons (and electrons in the case of metallic sliders) and eventually dissipated to the environment \cite{Manini_2016}.



Likewise all excitations generated in the simulations should be allowed to propagate in the system and disperese in the bulk of both sheet and substrate. Due to small simulation size theese is likely to relfect back and ´´pile up'' unphysically Thus in order to avoid continuous heating and attain a steady state the (Joule) heat must be removed at a steady state. This is very the viscous damping of the langevin equations enter the picture. It can be difficulut to set the value $\gamma$ for the magnitude of this damping. The unphysical introduction of heat sink can be mittigated by some modifictions he mention, which is kind of next level I guess. 


\subsection{Langevin thermostat} \label{sec:langevin}

% Check out \cite{Manini_2016} for a good theory section on this that I had
% completely missed when writing this!

% Based on
% https://www.uio.no/studier/emner/matnat/fys/FYS4130/v19/pensumliste/stat-phys_2019.pdf

% http://physics.gu.se/~frtbm/joomla/media/mydocs/LennartSjogren/kap6.pdf


In order to control the temperature of the system we introduce the so-called
Langevin thermostat. This is a stochastic thermostat that modifies Newtons
equation of motion such that solution lies in the canonical ensemble
characterized by a constant number of particles $N$, constant volume $V$ and
constant temperature $T$, hence denoted NVT. The canonical ensemble system is
represented by the finite system being in contact with an infinte heat bath of
temperature $T$. The NVT ensemble is equivalent to sampling a system in
theromodynamic equilibrium where the weight of each microscopic state is given
by the boltzmann factor $\exp[-E/(k_B T)]$.

The Langevin equation is the modified version of Newtons second law for a
Brownian particle. A brownian particle is a small particle suspendend in liquid,
e.g. pollen or dust, named after Robert brown (1773–1858) who was the first to
observe its jittery motion. The Langevin equation describes this motion as the
combination of viscous drag force $ -\gamma \vec{v}$, where $\gamma$ is a
positive friction coefficient and $\vec{v}$ the velocity vector, and a random
fluctuation force $\vec{R}$. The langevin equation reads
\begin{align}
  m \frac{d \vec{v}}{dt} = -\gamma \vec{v} + \vec{R}
  \label{eq:Langevin}
\end{align}
where $m$ is the particle mass. This effectively describes the particle of
interest, the brownian particle, as being suspendend in a sea of smaller
particles. The collision with these smaller particles is modelled by the drag
force and the fluctuation force. We notice that if the fluctuation force is
excluded \cref{eq:Langevin} becomes 
\begin{align*}
  m \frac{d \vec{v}}{dt} = -\gamma \vec{v} \quad \Rightarrow \quad 
  \vec{v}_i(t) = v(0)e^{- \frac{\gamma t}{m}},
\end{align*}
where the solution shows that the brownian particle will come to a complete stop
after a long time ${\vec{v}_i(t\to\infty) \to \vec{0}}$. This is in violation
with the equipartion theorem
\begin{align*}
  \frac{1}{2}m\langle v^2 \rangle_{eq} = \frac{k_B T}{2},
\end{align*}
and hence the fluctuation force is nessecary to obtain the correct equilibrium. 

The following calculations are done in one dimension in order to simplify the
notation. We describe the statistical nature of the collisions as a sum of
independent momentum transfers
\begin{align*}
  \Delta P = \sum_i^N \delta p_i
\end{align*}

where $\Delta P$ denotes the change of momentum after $N$ momentum transfers
$\delta p_i$ from the environment to the brownian particle. We assume the first
and second moments $\langle \delta p \rangle = 0$ and  $\langle \delta p \rangle
= \sigma^2$. When $N$ is large the central limit theorem states that the random
variable $\Delta P$ has a gaussian distribution with  $\langle P \rangle = 0$
and $\langle \Delta P^2 \rangle = N\sigma^2$. If we consider the momentum change
$\Delta P$  over a discrete time $\Delta t$, where the number of collisiosn is
proportional to time $N \propto \Delta t$, the corresponding fluctuation force
$R = \Delta P / \Delta t$ will have a variance 


\begin{align*}
  \langle R^2 \rangle = \frac{\langle \Delta P^2 \rangle}{\Delta t^2} = \frac{N \sigma^2}{\Delta t^2}  \propto \frac{1}{\Delta t}.
\end{align*}

In a computer simulation we need to pick a random force $R(t)$ from a Gaussian
distribution every time-step $\Delta t$. These forces will not be correlated as
long as $\Delta t$ is larger than the correlation time of the forces from the
molecules which we will assume for this model (I think there exist corrections
for this to refer to here). With this assumption we can write the correlation
function as 
\begin{align}
  \langle R(t) R(0) \rangle = 
  \begin{cases}
    \frac{a}{\Delta t}, & |\Delta t| < \Delta t/2 \\
    0, & |\Delta t| > \Delta t/2,
    \label{eq:disc_corr}
  \end{cases}
\end{align}

where $a$ is some strength of (...?). In the limit $\Delta t \to 0$ the
correlation function becomes

\begin{align}
  \langle R(t)R(0) \rangle = a \delta(t),
  \label{eq:F_corr}
\end{align}

% Note that the delta function is justified by the fact that the characteristic frequencies of the phonon and electron excitations are much shorter than the hopping rate of the tip between the minima of the interaction potential \cite{gnecco_meyer_2015}

where $\delta$ denotes the dirac delta function. This is valid for all spatial
coordinates which will all be independent of each other. Since both the drag
force and the fluctuation force originate from the molecular fluid, where the
drag force $-\alpha \vec{v}$ is velocity dependent it is reasonible to assume
that fluctuation force is independent of velocity, i.e. $\langle R_i v_j \rangle
= 0$ for all cartesian indices $i$ and $j$.


% Since $\langle \tilde{F} \rangle = 0$ the random force (fluctuating force)
% will not conribute with a average decay (change) to the velocity. The
% macroscopic decay comes from the friction force (dissipitative force)  $-ma
% =\alpha v$ (give variable explanation). 

In the following we will attempt justify the Langevin equaiton (why it is like
it is) and determine the relationship between the drag coefficient $\gamma$ and
the random force $R$.


From the Langevin equation \cref{eq:Langevin} we can compute the velocity
autocorrelation function (Move to appendix?). We do this in one dimension for
simplicity. We begin by multiplying by $(e^{\gamma t /m})/m$

\begin{align*}
  \dot{ v}(t)e^{\gamma t /m} + \frac{\gamma}{m} v(t)e^{\frac{\gamma t}{m}}  = \frac{ F}{m}e^{\frac{\gamma t}{m}},
\end{align*}
and integrate from $t = -\infty$. By the use of integration by parts on the
latter term on the left hand side we calculate the velocity 
\begin{align*}
  \int_{-\infty}^t dt' \ \dot{ v}(t')e^{\frac{\gamma t'}{m}} + \frac{\gamma}{m} v(t)e^{\frac{\gamma t'}{m}} &=  \int_{-\infty}^t dt' \ e^{\frac{\gamma t'}{m}} \frac{ F(t')}{m}  \\
  \int_{-\infty}^t dt' \ \dot{ v}(t')e^{\frac{\gamma t'}{m}} + \left(\Big[ v(t')e^{\frac{\gamma t'}{m}}\Big]_{-\infty}^t - \int_{-\infty}^t dt' \ \dot{ v}(t')e^{\frac{\gamma t'}{m}}\right) &= \int_{-\infty}^t dt' \ e^{\frac{\gamma t'}{m}} \frac{ F(t')}{m}  \\
   v(t) &= \int_{-\infty}^t dt' \ e^{\frac{-\gamma(t - t')}{m}} \frac{ F(t')}{m},
\end{align*}
where $e^{\frac{-\gamma t}{m}}$ plays the role of a response function. We can
then calculate the autocorrelation 
\begin{align*}
  \big\langle  v(t) v(0) \big\rangle &= \int_{-\infty}^t dt_1 \ \int_{-\infty}^0 dt_2 \ e^{\frac{t - t_1 - t_2}{m}} \frac{\langle  F(t_1)  F(t_2) \rangle}{m^2} \\
  &= \int_{-\infty}^t dt_1 \ \int_{-\infty}^0 dt_2 \ e^{\frac{t - t_1 - t_2}{m}} \frac{a \delta(t_1 - t_2)}{m^2} \\
  &= \int_{-\infty}^0 dt_2 \ e^{\frac{t - 2t_2}{m}} \frac{a}{m^2} = \frac{a}{2m\gamma}e^{-\frac{\gamma t}{m}},
\end{align*}
where we used \cref{eq:F_corr} and the fact that the integration commutes
with the average (we are allowed to flip the order). By comparing this with the
equipartition theorem we get 
\begin{align*}
  \frac{1}{2}m\langle  v^2 \rangle &= \frac{k_BT}{2} \\
  \frac{1}{2}m\langle  v(0) v(0) \rangle = \frac{a}{4\gamma} &= \frac{k_BT}{2} \\
  a &=  2\gamma k_B T \\
\end{align*}
We notice the appereance of $\gamma$ meaning that the magnitude of the
fluctuations increase both with friction and temperature. Further we can
integrate the velocity over time to get displacement $x(t)$ and show that the
variance (show this? In appendix maybe?) is 
\begin{align*}
  \big\langle x^2(t) \big\rangle = \frac{2 k_B T}{\gamma} \left(t - \frac{m}{\gamma}\left(1 - e^{-\gamma t/m} \right) \right),
\end{align*}
where for $t \gg m/\gamma$ only the $t$-term survies yielding
\begin{align*}
  \langle x^2(t) \rangle = 2 k_BTt/\gamma.
\end{align*}
In 1D, the diffusion constant $D$ is related to the variance as $\langle x^2
\rangle = 2Dt$, meaning that this represents the einstein relation $D = \mu k_B
T$ with the mobility $\mu = 1/\gamma$.

when $t \ll m/\gamma$ we use the Taylor expansion $1 - e^{-x} \approx x - x^2/2$
for $x\ll 1$ to get 
\begin{align*}
  \big\langle x^2(t) \big\rangle = \frac{k_B T}{m} t^2
\end{align*}
which exactly mathces the thermal velocity
\begin{align*}
  v_{\text{th}} \frac{\big\langle x^2(t) \big\rangle}{t^2} = \frac{k_B T}{m}
\end{align*}
which follows from the equipartition theorem. The finite correlation time
$\gamma/m$ hence describe the crossover from the ballistic regime $\sqrt{\langle
x^2(t) \rangle} \propto t$ to the diffusive regime $\sqrt{\langle x^2(t)
\rangle} \propto \sqrt{t}$.

Introduce the fluctuation-dissipation theorem concept earlier since this is a
motivaiton for the Langeivn equation. 


% Of course, this approach is not rigorous, since the relevant particles
% colliding with each given simulated atom are already all included in the
% conservative and deterministic forces explicitly accounted for by the “force
% field”. The Langevin approach is quite accurate to describe small
% perturbations away from equilibrium, but it may fail quite badly in the
% strongly out-of-equilibrium nonlinear phenomena which are the target of the
% present paper.  \cite{Manini_2016}

\subsection{Implementing Langevin}
% https://docs.lammps.org/fix_langevin.html

% https://www2.ph.ed.ac.uk/~dmarendu/MVP/MVP03.pdf

% https://chem.libretexts.org/Bookshelves/Physical_and_Theoretical_Chemistry_Textbook_Maps/Non-Equilibrium_Statistical_Mechanics_(Cao)/01%3A_Stochastic_Processes_and_Brownian_Motion/1.04%3A_The_Langevin_Equation

% \cite{Hunenberger2005}(pp. 115, 120-121) \cite{docs_lammps_langevin}

% Make a note: We only introduce the thermostat to the edges of the parts of
% interest as the thermostat might disrupt important properties of the
% simulation (accoridng to Henrik, get a source/example on this).


The implementation of the Langevin equation into LAMMPS follows
\cite{PhysRevB.17.1302} and updates the force vector for each particle as 

\begin{align}
  \vec{F} &= \vec{F_c} + \vec{F}_{f} + \vec{F}_{r} \nonumber \\
  &= -\nabla U - \gamma m \vec{v} + \sqrt{\frac{2 k_B T m \gamma}{\Delta t}}\vec{h}(t)
  \label{eq:Langevin_generalized}
\end{align}
where $\vec{F_c}$ is the conservative force computed via the usual
inter-particle interactions described by the potential $U$, $\vec{F}_f$ is the
drag force and $\vec{F}_r$ is the random fluctuation force where $\vec{h}$ is a
random vector drawn from a normal distribution with zero mean and unit variance.
Notice that this generalized description of the Langevin equation deviates from
the presentation in \cref{eq:Langevin} since we have added the conservative
force $\vec{F_c}$, but also by the appearance of the mass in both the drag force
and the fluctuation force due to the introduction of damping. It is beyond out
scope to comprehend this. However, the fact that $\Delta t$ now appears in the
denomiator for the random force variance $2k_B T m \gamma / \Delta t$ is due to
the fact that we have discretized time. This in agreement with the formulation
in \cref{eq:disc_corr}. By applying \cref{eq:Langevin_generalized} we
get the refined velocity verlet scheme


\begin{align*}
  \vec{v}_i(t + \Delta t/2)  &= \vec{v}_i(t) - \frac{\Delta t}{2}\left(\frac{\nabla_i U(t)}{m_i} + \gamma \vec{v}_i \right) + \sqrt{\frac{k_B T \gamma \Delta t}{2m_i}} \vec{h}_i \\ 
  \vec{r}_i(t + \Delta t) &= \vec{r}_i(t) + \vec{v}_i(t + \Delta t/2) \Delta t \\
  \vec{v}_i(t + \Delta t) &= \vec{v}_i(t+ \Delta t/2) - \frac{\Delta t}{2}\left(\frac{\nabla_i U(t + \Delta t)}{m_i} + \gamma \vec{v}_i(t + \Delta t/2) \right) + \sqrt{\frac{k_B T \gamma \Delta t}{2m_i}} \vec{h}_i
\end{align*}
% A little unsure whether the factor 2 in the denominator in the random force is
% correct.
with new random vector $\vec{h}_i$ for each particle and each update. Notice
however, that LAMMPS only apply this scheme to the particle groups with the
thermostat on. 

% \newpage

% \begin{align} \vec{F}_i &= \vec{f}_{i} + \vec{f}_{f,i} + \vec{f}_{r,i}
%   \nonumber \\
%   m_i \ddot{\vec{r}}_i &= \vec{f}_{i} - \gamma_i \vec{p}_i + \vec{R}_i(t)
%   \label{eq:langevin_old} \end{align}

% where $m_i$ is the mass of particle $i$ $\vec{r}_i$ the position vector. The
% random force $\vec{R}_i(t)$ is described as gaussian white noise and have the
% following properties. 

% \begin{enumerate} \item It is uncorrelated with the velocities
%   $\dot{\vec{r}}(t)$ and deterministic forces $\vec{f}_i(t')$ at previous
%   times $t' < t$. \item The time average is zero: $\langle \vec{R}(t) \rangle
%   = \vec{0}$. \item The mean-square components evaluate to $2m_i\gamma_i k_B
%   T$. \item The force component of particle $i$ $R_{i,\mu}$ along cartesian
%   axis $\mu$ is uncorrelated with any component of particle $j$ $R_{i,\nu}$
%   along cartesian axis $\nu$, unless $i=j$, $\mu=\nu$ and $t=t'$.
%   \end{enumerate}

% The ladder two conditions can be formulated as

% \begin{align*} \langle R_{i,\mu}(t) R_{j,\nu}(t') \rangle = 2m_i \gamma_i k_B
%   T  \delta_{ij} \delta_{\mu\nu}\delta(t'-t),  
% \end{align*}

% where $\delta_{\cdot\cdot}$ is the Kronecker Delta function and
% $\delta(\cdot)$ is the Dirac Delta function. It can be shown that a trajectory
% generated by integrating the Langevin equations of motion
% (\cref{eq:langevin_old}) maps a cononical distribution of microstates at
% temperature $T$. \cite{Hunenberger2005}(p.121). (Can I say something more
% about the relationship between the friction froce and the random force - How
% to the balance to give NVT. Is the proof complicated?)\\

% In practice the implementation of the thermostat is implemented discretely by
% updating the force on each particle by the addition of the described forces
% $f_f$ and $f_r$ for each particle. In LAMMPS this is controlled by the user
% defined damping factor ``damp'' = $\gamma^{-1}$ in units of time whih control
% how fast we are going to reach the temperature equlibrium. Thus the
% documentation (\cite{docs_lammps_langevin}) defines the added forces as

% \begin{align*} f_f &= -\frac{m}{\text{damp}}, \qquad f_r \propto \sqrt{\frac{m
%   k_B T}{dt \ \text{damp}}} \end{align*}

% where $v = \dot[r]$ is the velocity. The definition of $f_f$ falls straight
% out of the definition above in \cref{eq:Langevin} while the
% proportionality of $f_r$ comes from

% \begin{align*} \sqrt{\langle R(t)^2 \rangle} = \sqrt{2m\gamma k_B T} \propto
%   \sqrt{\frac{m k_B T}{\text{damp}}} \end{align*}

% Thus we have $f_r \propto \sqrt{\langle R(t)^2 \rangle / dt}$ which I do not
% quite understand. It is mentioned in
% \url{https://pubs.acs.org/doi/full/10.1021/ct8002173} when talkikng about
% residual forces, as it is natural when taking a step length of $dt$...
% Probably simply, but check this later. 


% https://www2.ph.ed.ac.uk/~dmarendu/MVP/MVP03.pdf



% \begin{align*} \vec{r}_i(t + \Delta t) &= \vec{r}_i(t) + \vec{v}_i(t) \Delta t
%   + \frac{\vec{F}_i(t)}{2m_i}\Delta t^2 + \mathcal{O}(\Delta t^3), \\
%   \vec{v}_i(t+\Delta t)  &= \vec{v}_i(t) + \frac{\vec{F}_i(t) +
% \vec{F}_i(t+\Delta t)}{2m_i}  \Delta t + \mathcal{O}(\Delta t^3). \end{align*}



% \newpage This section is based on \cite{PhysRevB.17.1302},
% \cite{Hunenberger2005}(pp. 115, 120-121) and \cite{docs_lammps_langevin}



% %
% https://www.uio.no/studier/emner/matnat/fys/FYS4130/v19/pensumliste/stat-phys_2019.pdf

% ``The Langevin equation is Newtons second law for a Brownian particle, where
% the forces include both the viscous drag due to the surrounding fluid and the
% fluctuations caused by the individual collisions with the fluid molecules.''


% % http://physics.gu.se/~frtbm/joomla/media/mydocs/LennartSjogren/kap6.pdf

% % https://www2.ph.ed.ac.uk/~dmarendu/MVP/MVP03.pdf ``Another option to
% simulate a system in the NVT ensemble is to use a stochastic thermostat, as
% opposed to the deterministic thermostat defined through the Nose-Hoover
% equations.''

% ``The equations of mo- tion of a system with a stochastic thermostat are known
% as Brownian dynamic equations''

% In order to simulate the canonical ensemble, that is the ensemble defined by a
% constant amount of particles $N$, constant temperature $T$ and constant volume
% $V$, hence often denoted $NVT$, we apply a so-called thermostat. There exist a
% variety of such including Nosé-Hoover, Gaussian, Berendsen, Langevin
% thermostat and many other (give example of how they modify) We will use the
% ladder. \\
% The connical ensemble is an ensemble of systems by the assumption that the
% system of interests is connected to an infitely large heat bath of temperature
% $T$. The Langevin thermostat assumes that the particles collides with much
% smaller lighter particles representing the heat bath as a sea of small
% particles. The collisions is described by a friction force $f_f = -\gamma
% \vec{p}$, where $\gamma$ is positiv friction coefficient and $\vec{p}$ the
% momentum vector, and a random force $f_r = \vec{R}_i(t)$. By denoting the
% conservative force arising from the usual inter-particle interactions
% $\vec{f}_i$ on particle $i$ we get the Langevin equations of motion describing
% the total force $\vec{F}_i$ on particle $i$ as

% see https://www2.ph.ed.ac.uk/~dmarendu/MVP/MVP03.pdf p. 4


\section{MD limitations (?)}

% One of the limitations of concern is in regard to the simulation scale. Despite relatively fast processor speed and efficient algorithm the number of atoms that can be handled realistically is still insufficient for complex system simulation \cite{kim_nano-scale_2009}.



% The main problem when studying the velocity dependence of friction by MD
% simulations is the fact that speeds below few m/s are not accessible. These
% values are well above typical speeds at which atomic stick–slip is resolved by
% AFM (nm/s to μm/s). The reason for that is the typical time scales in MD, which
% are of the order of 1 fs. Furthermore, phenomena such as thermally activated
% hopping are not effective at high speeds, which makes any attempts to
% extrapolate the model predictions on the velocity dependence of friction quite
% doubtful. A possible solu- tion consists of accelerating the simulations during
% the long stick phases separating rapid slip events. \cite[p.
% 207]{gnecco_meyer_2015}


\section{LAMMPS}

